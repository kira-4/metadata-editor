version: '3.8'

services:
  metadata-editor:
    build: .
    container_name: metadata-editor
    restart: unless-stopped

    environment:
      - INCOMING_ROOT=/incoming
      - NAVIDROME_ROOT=/music
      - DATA_DIR=/data
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - SCAN_INTERVAL_SECONDS=30
      - TZ=America/Los_Angeles
      - PORT=8090

    volumes:
      # Mount Pinchflat download directory (read/write)
      - /path/to/pinchflat/downloads:/incoming

      # Mount Navidrome music library (read/write)
      - /path/to/navidrome/music:/music

      # Persistent service data (database, artwork cache)
      - ./data:/data

    ports:
      - "8090:8090"

    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8090/api/pending" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
